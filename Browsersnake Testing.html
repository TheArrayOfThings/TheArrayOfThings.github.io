<!DOCTYPE HTML>
<html>
	<head>
		<!-- <meta http-equiv="X-UA-Compatible" content="chrome=1, IE=edge"> -->
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
		<meta name="description" content="A simple snakey game - only your browser required!">
		<meta name="author" content="Ryan Flanagan">
		<meta name="keywords" content="Portfolio, html, css, javascript, c#, java, snake, game">
		<meta charset="UTF-8">
			<title>BrowserSnake</title>
		<link rel="icon" type="image/x-icon" href="./BrowserSnake/images/logobasic.ico">
		<script src="./js/compatibility.js"></script> 
		<script src="./js/jquery.js"></script> 
		<script>
			var topBarLoaded;
			$(function(){
			  $("#topBar").load("./html/TopBar.html", function () {
				topBarLoaded = true;
			  }); 
			  $("#footer").load("./html/Footer.html");
			});
		</script> 
		<link rel="stylesheet" href="./css/Ultimate.css">
		<link rel="stylesheet" href="./Highlight/styles/stackoverflow-dark.min.css">
	</head>
	<body>
		<div id="modalOverlay"></div>
		<div id="topBar"></div>
		<div id="modalBox" class="modal">
		  <!-- Modal popup content -->
		  <div class="modal-content">
			<h1 id="modalTitle"></h1>
			<p id="modalTextContent">Default content</p>
			<label id="modalInputLabel" for="modalInput">Input:</label>
			<input type="text" id="modalInput" name="modalInput">
			<button class="modalYes">Yes</button>
			<button class="modalNo">No</button>
			<button class="modalButton">Submit</button>
		  </div>
		</div>
		<div class="main">
			<h1>Welcome</h1>
			<p>This is BrowserSnake! A game made entirely in pure Javascript, HTML, and CSS!</p>
			<ul class="contentMenu"></ul>
			<div id="background">
				<div id="playable">
					<p id="info"></p>
					<table class='scoreboard'>
						<tr class="scoreLabels">
						<th class='scoreboard'>Your Best</th>
						<!-- <th class='scoreboard'>Top Score</th> -->
						</tr >
						<tr class="scores">
						<th class='scoreboard pershighscore'>0</th>
						<!-- <th class='scoreboard servhighscore'>0</th> -->
						</tr >
					</table >
					<div id="topSectionVisible" class="section">Up</div>
					<div id="bottomSectionVisible" class="section">Down</div>
					<div id="leftSectionVisible" class="section">Left</div>
					<div id="rightSectionVisible" class="section">Right</div>
					<button type="button" id="pause">Pause</button>
					<button type="button" id="settings">Settings</button>
					<div id="topSection" class="section"></div>
					<div id="bottomSection" class="section"></div>
					<div id="leftSection" class="section"></div>
					<div id="rightSection" class="section"></div>
				</div>
				<div id="playOverlay"><button id="playButton">Play</button></div>
			</div>
			<div class="expandableSection">
				<a class="expandableHeader">Overview</a>
					<div class="expandableContent">
						<h2>Premise</h2>
						<p>I wanted to get better at Javascript, CSS, and DOM manipulation so I decided the best way to do that would be to create a simple game.</p>
						<p>As as kid, I remember playing a lot of Snake 2 on my dad's Nokia phone. I figured this would be an easy game to recreate in the Browser!</p>
						<p>I didn't stop there, adding more and more features until I created the game as it is now.</p>
						<h2>Features</h2>
						<ul>
							<li>Switch between classic Snake 2 and BrowserSnake</li>
							<li>Customisable settings, including name, colours, AI number</li>
							<li>Two player mode (not supported on mobile)</li>
							<li>Touch controls (mobile only)</li>
							<li>AI controlled snakes & enemies</li>
							<li>Powerups with random effects</li>
							<li>Score board and scoring system</li>
							<li>Custom modal box for prompts, alerts, and confirmations</li>
							<li>Fully scaleable to any size display</li>
							<li>Compatible with most browsers and devices</li>
							<li>Cheat codes and easter eggs!</li>
						</ul>
					</div>
			</div>
			<div class="expandableSection">
				<a class="expandableHeader">Game Board</a>
				<div class="expandableContent">
					<h2>Playable Area & Background</h2>
					<p>The game board is made up of two div elements, there is a background div element and a playable area div element. 
					The playable area is dynamically scaled so that it exactly fits a grid of squares, these squares acting as tiles in a game. 
					Every element in the game, such as a snake segment, an enemy, or a powerup, takes up exactly one of these tiles.</p>
					<img src="./BrowserSnake/images/Grid-Visualised.png" alt="Image showing the grid of squares that makes up the playable area of the game" title	="Image showing the grid of squares that makes up the playable area of the game">
					<h2>Scaling and Re-scaling</h2>
					<p>Tile size is crucial to keeping everything scaled correctly. The tile size is referenced as 'entitySize' in the game, and is calculated by the following formula:
					<pre><code class="language-javascript">entitySize = Math.ceil((Math.sqrt(pixelHeight*pixelWidth)/100)*scale);</code></pre>
					</p>
					<p>Scale is an integer that lets me easily, and globally, change the size of all the entities of the game, whilst 'pixelWidth' and 'pixelHeight' are the respective background div width and height in pixels, but with the parity made even if they happen do be odd:
					<pre><code class="language-javascript">pixelWidth = background.clientWidth;
if (pixelWidth % 2 != 0) {
	--pixelWidth;
}
pixelHeight = background.clientHeight;
if (pixelHeight % 2 != 0) {
	--pixelHeight;
}</code></pre></p>
					<p>Calculating the 'entitySize' (or tile size) ensures that the game scales with the device's screen width/height.</p>
					<p>There is an event listener setup that will reset the game, including recalculating 'entitySize' and rescaling the game board, that detects when the screen size changes:
<pre><code class="language-javascript">//Handle resize of window
addEvent("resize", window, function() {
	//Game is already resetting, so ignore the reset.
	if (resetting) {
		return;
	}
	//Using a timeout to prevent the reset from being called too frequently, and to delay the reset
	//Delaying the reset prevents the game resetting every screen refresh 
	//This could happen if the user is manually resizing the browser window by dragging, for example
	resizeSnakeyRtime = new Date();
	if (resizeSnakeyTimeout === false) {
		resizeSnakeyTimeout = true;
		//snakeyResizeend is the function that handles the game reset
		setTimeout(snakeyResizeend, resizeSnakeyDelta);
	}
});</code></pre>(The 'addEvent' function is a polyfill for 'addEventListener' that supports internet explorer!)</p>
				<p>The event listener calls 'snakeyResizeend' which checks whether a reset should actually happen:
<pre><code class="language-javascript">function snakeyResizeend() {
	//First, recalculate the pixelWidth and pixelHeight
	let newPixelWidth = background.clientWidth;
	if (newPixelWidth % 2 != 0) {
		--newPixelWidth;
	}
	let newPixelHeight = background.clientHeight;
	if (newPixelHeight % 2 != 0) {
		--newPixelHeight;
	}
	//If the newly calculated values are the same as the old ones, then we don't need to re-scale and reset
	//This happens on mobile sometimes, where hiding the searchbar triggers the event but doesn't require re-scaling/resetting
	if (newPixelHeight == pixelHeight && newPixelWidth == pixelWidth) {
		return;
	}
	//If less time has passed than the resizeSnakeyDelta, call this function again
	if (new Date() - resizeSnakeyRtime &lt; resizeSnakeyDelta) {
		setTimeout(snakeyResizeend, resizeSnakeyDelta);
	} else { //Otherwise proceed to reset everything
		resizeSnakeyTimeout = false;
		resetEverything();
	}               
}</code></pre></p>
				<p>The 'resetEverything' function is called at the beginning of the game, and also when re-scaling.
				It resets the game state back to default by removing all spawned objects, resizing the playable area, resetting the score, and clearing the frame interval (see the <a href="#FrameInterval" onclick="toggleSection('FrameInterval')">Frame Interval</a> section!).
				</div>
			</div>
					<div class="expandableSection">
					<a class="expandableHeader">Entities</a>
						<div class="expandableContent">
						<h2>Overview</h2>
						<p>Every object in the game (such as snakes, bullets, enemies, and powerups) use a base Javascript object called 'Entity'. 
						The 'Entity' object is my way of bringing object-oriented programming to Javascript, as the 'Entity' acts as a parent class, with child classes inheriting common functions, such as handling collision, movement, and some AI functionality.</p>
						<p>Below is some pseudo code to demonstrate this:
<pre><code class="language-javascript">function Entity() {
	//'entity' here is an object. 
	//Other "classes" can extend this object.
	var entity = {
		//Example of inheritable property
		aiDriven: false,
		//Example of inheritable function
		moveStep: function() {
			//Functionailty to move the entity
		},
	};
	//'allEntities' is useful for looping through all the entities
	//The gamestate makes use of this to detect collisions, remove all the entities on reset etc
	allEntities.push(entity);
	return entity;
}

function Snake(snakeNameParam) {
	//Extend the Entity base object
	var snake = new Entity();
	//Example of setting a new property
	snake.snakeName = snakeNameParam;
	//Example of setting a  new function
	snake.move = function() {
		//As 'Snake' inherited from 'Entity', can access the properties and functions of 'Entity'
		if (snake.aiDriven) {
			snake.moveStep();
		}
	};
	return snake;
}

//New 'Snake' with all the functions and properties of Entity and Snake "classes"
let playerSnake = new Snake("Ryan");</code></pre></p>
				<p>The 'Entity' class alone contains the following functions:</p>
				<table>
					<tr>
						<th>Function</th>
						<th>Purpose</th>
					</tr>
					<tr>
						<td>moveStep</th>
						<td>Used by the gamestate to move the entities.</th>
					</tr>
					<tr>
						<td>autoChooseDirection</th>
						<td>If 'aiDriven' equals true, the entity will choose a direction automatically.</th>
					</tr>
					<tr>
						<td>willCollide</th>
						<td>Used by the gamestate. Returns true or false for a given direction. Used for collision detection and AI pathing.</th>
					</tr>
					<tr>
						<td>kill</th>
						<td>Removes the object from the game. Used by the gamestate when resetting, or after collisions.</th>
					</tr>
						<td>alternativeAction</th>
						<td>Function called at the end of moveStep. Does nothing in 'Entity' but can be overloaded in child classes.</th>
					</tr>
						<td>alternativeDeathAction</th>
						<td>Similar to alternativeAction, but runs during 'kill' function. Used for scoreboard updates mostly.</th>
					</tr>
				</table>
				<p>The 'Snake' class adds 10 more function in addition to these.</p>
				</div>
			</div>	
			<div class="expandableSection">
				<a class="expandableHeader">Frame Interval</a>
					<div class="expandableContent">
						<h2>Premise</h2>
						<p>It is important to keep everything in sync in Snake.
						Each entity in the game needs to move one after another, otherwise collision handling becomes very difficult.</p>
						<p>The game uses a setInterval called 'frameInterval' on a loop to run through each frame of the game. It handles the following over the course of a frame:</p>
						<ul>
							<li>Checks for any entities that have 'died' since the last frame and cleans them up</li>
							<li>Checks for any collisions (entities that occupy the same tile) and handles the collision</li>
							<li>Checks if any of the snakes have hit an edge, and teleports them to the other edge if so</li>
						</ul>
						<h2>Collisions</h2>
						<p>Most of the interesting logic from the game happens in the collision handling logic. For example, a snake colliding with a powerup:</p>
<pre><code class="language-javascript">function powerUpHit(whichSnake) {
	//First, check if the game is currently resetting. If so, do nothing.
	if (resetting) {
		return;
	}
	//Increase the score of the snake that hit the powerup
	whichSnake.internalScore = whichSnake.internalScore + 1;
	//Update that snakes scoreboard to reflect this
	whichSnake.scoreBox.innerHTML = whichSnake.internalScore;
	//If the score is the highest that snake has had (and the snake is a player) then update the highscore
	//and store the new highscore in local storage
	if (whichSnake.internalScore > persHighScore && whichSnake.aiDriven == false) {
		persHighScore = whichSnake.internalScore;
		persHighScoreBox.innerHTML = persHighScore + " (" + whichSnake.snakeName + ")";
		//Only set the localstorage if not internet explorer, as IE doesn't support this.
		if (!isInternetExplorer) {
			localStorage.setItem("PersonalHighScore", persHighScore);
			localStorage.setItem("PersonalHighScoreName", whichSnake.snakeName);
		}
	}
	//Increase the length of the snake that hit the powerup
	//Set the returned div element to not display initially, as we only want to see it once the snake has moved a step
	whichSnake.appendSegment().style.display = 'none';
	//Classic snake doesn't use the random effects, so don't use this if classic snake
	if (!classicSnake) {
		//Get one of the random effects and apply it to this snake
		effects.getRandomEffect()(whichSnake);
	}
	//Move the powerup to a new location (randomiseLocation avoids collisions)
	randomiseLocation(powerUp.collisionDiv);
}</code></pre>
					
					</div>
			</div>
		</div>
		<div id="footer"></div>
		<script>
			//Check for IE and load only if not IE
			if (!isInternetExplorer) {
				$(function(){
					$.ajax({
						url: "./Highlight/highlight.min.js",
						dataType: "script",
						contentType: "text/javascript",
						beforeSend: function(xhr){  xhr.overrideMimeType( "text/javascript; charset=x-user-defined" );},
						success: function() {
							hljs.highlightAll();
						}
					});
				});
			}
		</script>
		<script src="./js/ExpandableSection.js"></script>
		<script src="./js/Logo.js"></script>
		<script src="./js/Selected.js"></script>
		<script src="./js/MenuBurger.js"></script>
		<script src="./js/SetTitle.js"></script>
		<script src="./js/ModalBox.js"></script>
		<script src="./BrowserSnake/js/game.js"></script>
		<script src="./BrowserSnake/js/entity.js"></script>
		<script src="./BrowserSnake/js/powerup.js"></script>
		<script src="./BrowserSnake/js/effects.js"></script>
		<script src="./BrowserSnake/js/snake.js"></script>
		<script src="./BrowserSnake/js/snakesegment.js"></script>
		<script src="./BrowserSnake/js/bullet.js"></script>
		<script src="./BrowserSnake/js/enemy.js"></script>
	</body>
</html>